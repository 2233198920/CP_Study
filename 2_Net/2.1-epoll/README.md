# 文件描述符（File Descriptor）详解

## 基本概念

文件描述符（FD）是一个非负整数，在UNIX/Linux系统中用于表示打开的文件、socket、管道等I/O资源。它是一个索引值，指向内核为每个进程维护的该进程打开文件的记录表。

### 特殊文件描述符
- 0: 标准输入 (STDIN)
- 1: 标准输出 (STDOUT)
- 2: 标准错误 (STDERR)

## 在网络编程中的应用

### Socket文件描述符
1. **监听Socket (sockfd)**
   - 由`socket()`函数创建
   - 用于监听新的连接请求
   - 通常绑定到特定端口

2. **客户端Socket (clientfd)**
   - 由`accept()`函数返回
   - 用于与特定客户端通信
   - 每个新的客户端连接都会获得一个唯一的描述符

### 重要系统调用
- `socket()`: 创建新的socket，返回文件描述符
- `bind()`: 将socket绑定到特定地址和端口
- `listen()`: 将socket置于监听状态
- `accept()`: 接受新的连接，返回新的文件描述符
- `read()/write()`: 通过文件描述符读写数据
- `close()`: 关闭文件描述符

## 文件描述符的特性

1. **唯一性**
   - 在同一进程中，文件描述符是唯一的
   - 新的文件描述符总是使用最小可用的整数值

2. **继承性**
   - 子进程会继承父进程的文件描述符
   - fork()后两个进程共享相同的文件表项

3. **限制**
   - 系统对每个进程的文件描述符数量有限制
   - 可通过ulimit命令查看和修改限制

## 使用建议

1. **及时关闭**
   - 不再使用的文件描述符应立即关闭
   - 防止资源泄露和描述符耗尽

2. **错误处理**
   - 始终检查文件操作的返回值
   - 使用perror()或strerror()处理错误

3. **多路复用**
   - 使用select/poll/epoll管理多个文件描述符
   - 避免为每个连接创建新线程
```
